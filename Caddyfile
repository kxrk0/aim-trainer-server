# ===================================================
# LIORABELLE LEATHER - TEMIZ & ORGANİZE CADDYFILE
# ===================================================
# Ana site + AIM TRAINER subdomain için optimize edilmiş
# ===================================================

# ===================================================
# ANA SİTE: liorabelleleather.com
# ===================================================
liorabelleleather.com {
    # Yönlendirme Kuralları
    handle /socket.io/* {
        reverse_proxy localhost:3001
    }
    
    handle /api/* {
        reverse_proxy localhost:3001
    }
    
    # Next.js Frontend (port 3000)
    reverse_proxy localhost:3000
    
    # SSL & Güvenlik
    tls {
        protocols tls1.2 tls1.3
    }
    
    encode gzip zstd
    
    header {
        X-Frame-Options "SAMEORIGIN"
        X-Content-Type-Options "nosniff"
        Referrer-Policy "strict-origin-when-cross-origin"
        Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
    }
    
    # Ana site loglama
    log {
        output file /var/log/caddy/liorabelleleather.log {
            roll_size 10MB
            roll_keep 5
            roll_keep_for 720h
        }
        format json
    }
}

# ===================================================
# AIM TRAINER: aim.liorabelleleather.com 
# ===================================================
aim.liorabelleleather.com {
    # Socket.IO WebSocket Proxy
    handle /socket.io/* {
        reverse_proxy localhost:3002
    }
    
    # Backend API Routes
    handle /api/* {
        reverse_proxy localhost:3002
    }
    
    # Static Files and Fallback
    handle /* {
        reverse_proxy localhost:3002
    }
    
    # SSL Otomatik (Let's Encrypt)
    # Caddy otomatik SSL sertifikası alacak
    
    # Performans
    encode gzip zstd
    
    # Güvenlik + CORS
    header {
        X-Frame-Options "SAMEORIGIN"
        X-Content-Type-Options "nosniff"
        Referrer-Policy "strict-origin-when-cross-origin"
        Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
        
        # CORS başlıkları (AIM TRAINER için)
        Access-Control-Allow-Origin "*"
        Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
        Access-Control-Allow-Headers "Content-Type, Authorization"
    }
    
    # AIM TRAINER loglama
    log {
        output file /var/log/caddy/aim-trainer.log {
            roll_size 10MB
            roll_keep 5
            roll_keep_for 720h
        }
        format json
    }
}

# ===================================================
# WWW YÖNLENDİRMELERİ
# ===================================================

# Ana site www yönlendirmesi
www.liorabelleleather.com {
    redir https://liorabelleleather.com{uri} permanent
}
